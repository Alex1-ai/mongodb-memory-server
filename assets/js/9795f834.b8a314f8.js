"use strict";(self.webpackChunkmongodb_memory_server_website=self.webpackChunkmongodb_memory_server_website||[]).push([[515],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return u}});var o=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=o.createContext({}),l=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=l(e.components);return o.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),p=l(t),u=i,h=p["".concat(s,".").concat(u)]||p[u]||m[u]||a;return t?o.createElement(h,r(r({ref:n},c),{},{components:t})):o.createElement(h,r({ref:n},c))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,r=new Array(a);r[0]=p;var d={};for(var s in n)hasOwnProperty.call(n,s)&&(d[s]=n[s]);d.originalType=e,d.mdxType="string"==typeof e?e:i,r[1]=d;for(var l=2;l<a;l++)r[l]=t[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},5051:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return d},contentTitle:function(){return s},metadata:function(){return l},toc:function(){return c},default:function(){return p}});var o=t(7462),i=t(3366),a=(t(7294),t(3905)),r=["components"],d={id:"docker",title:"Integration with Docker"},s=void 0,l={unversionedId:"guides/integration-examples/docker",id:"guides/integration-examples/docker",isDocsHomePage:!1,title:"Integration with Docker",description:"This Guide will show how mongodb-memory-server can be used with Docker & dockefiles.",source:"@site/../docs/guides/integration-examples/docker.md",sourceDirName:"guides/integration-examples",slug:"/guides/integration-examples/docker",permalink:"/mongodb-memory-server/docs/guides/integration-examples/docker",editUrl:"https://github.com/nodkz/mongodb-memory-server/edit/master/docs/../docs/guides/integration-examples/docker.md",tags:[],version:"current",frontMatter:{id:"docker",title:"Integration with Docker"},sidebar:"guides",previous:{title:"Integration with Test Runners",permalink:"/mongodb-memory-server/docs/guides/integration-examples/test-runners"},next:{title:"Enable Debug Mode",permalink:"/mongodb-memory-server/docs/guides/enable-debug-mode"}},c=[{value:"Important Notes before Starting",id:"important-notes-before-starting",children:[]},{value:"Writing a dockerfile with mongodb binary caching",id:"writing-a-dockerfile-with-mongodb-binary-caching",children:[{value:"<code>.dockerignore</code>",id:"dockerignore",children:[]},{value:"<code>dockefile</code>",id:"dockefile",children:[]}]}],m={toc:c};function p(e){var n=e.components,t=(0,i.Z)(e,r);return(0,a.kt)("wrapper",(0,o.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This Guide will show how ",(0,a.kt)("inlineCode",{parentName:"p"},"mongodb-memory-server")," can be used with Docker & dockefiles."),(0,a.kt)("h2",{id:"important-notes-before-starting"},"Important Notes before Starting"),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"It is common that images like ",(0,a.kt)("inlineCode",{parentName:"p"},"node:16-alpine")," are used, which will not work with this package, because mongodb does not provide binaries for Alpine yet.\nIt is recommended to switch to images like ",(0,a.kt)("inlineCode",{parentName:"p"},"node:16")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"node:16-buster"),") for Debian builds."),(0,a.kt)("p",{parentName:"div"},"See ",(0,a.kt)("a",{parentName:"p",href:"/mongodb-memory-server/docs/guides/known-issues#no-build-available-for-alpine-linux"},"No Build available for Alpine Linux"),"."))),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Docker Debian builds (at least with ",(0,a.kt)("inlineCode",{parentName:"p"},"debian:11"),"), extra packages have to be installed:"),(0,a.kt)("pre",{parentName:"div"},(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"apt-get install libcurl4 # for Debian 10+ to fix CURL_OPENSSL_4\n# OR\napt-get install libcurl3 # for Debian 9 (and before) to fix CURL_OPENSSL_3\n")))),(0,a.kt)("h2",{id:"writing-a-dockerfile-with-mongodb-binary-caching"},"Writing a dockerfile with mongodb binary caching"),(0,a.kt)("p",null,"Sometimes you want to have the tests isolated from the host system and also have caching working for mongodb-memory-server."),(0,a.kt)("h3",{id:"dockerignore"},(0,a.kt)("inlineCode",{parentName:"h3"},".dockerignore")),(0,a.kt)("p",null,"If no ",(0,a.kt)("inlineCode",{parentName:"p"},".dockerignore")," is specified or the following instructions added to the ",(0,a.kt)("inlineCode",{parentName:"p"},"dockerfile"),", some cases may happen:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Best case is just added bloat if the host system is not debian (like having the host's mongodb binary copied into the image)"),(0,a.kt)("li",{parentName:"ul"},"If the host system is Debian (and to that not matching version), then the host's mongodb binary is copied in and will be used instead of downloading the actual required mongodb binary")),(0,a.kt)("p",null,"It is not required to have, but preferred over having a additional step in the dockerfile:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerignore"},"# ignore all node_modules, no matter where, like when having a monorepo\n**/node_modules\n")),(0,a.kt)("p",null,"If a dockerignore is not specified, a additional instruction can be used instead:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},'# ...\nCOPY node:node . /project\n\n# Put this Instruction between the 2 other instructions mentioned in this example\n# The following deleted all directories it finds that are a directory AND have a name matching "node_modules" (also removes nested directories)\nRUN find . -type d -iname "node_modules" -exec rm -rf {} \\;\n\nRUN npm install\n# ...\n')),(0,a.kt)("h3",{id:"dockefile"},(0,a.kt)("inlineCode",{parentName:"h3"},"dockefile")),(0,a.kt)("p",null,"The following is the recommended way to make a image with mongodb-memory-server"),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"The following ",(0,a.kt)("inlineCode",{parentName:"p"},"dockerfile")," has examples for 2 package managers: ",(0,a.kt)("inlineCode",{parentName:"p"},"npm")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn"),", be sure to remove the one that will not be used."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},'# Using a Debian build\nFROM node:16\n\n# Installing "libcurl4" because some Debian images may not come with this package installed, but is required by the mongodb binaries\nRUN apt-get install libcurl4\n\n# Settings the CWD (Current Work Directory) to "/project" to have a isolated folder for the project\n# Note: it is not recommended to set it to "/home/dockeruser", but to use "/home/dockeruser/project"\nWORKDIR /project\n\n# Copy the project (all files) into the image into "/project" as user "node:node"\n# User "node:node" is the default nodejs user in the docker images\nCOPY node:node . /project\n\n# Explicitly set the user that will be used for the next Instructions and ENTRYPOINT\nUSER node\n\n# Install all required dependencies locked to the package-lock (or yarn.lock)\n# Replace "npm install" with your package manager command of choice\nRUN npm install --ci\n# OR\nRUN yarn install --frozen-lockfile\n\n# Set the default command that will be used when running the image\n# Replace this with your command / package manager command of choice\nENTRYPOINT ["npm", "run", "test"]\n# OR\nENTRYPOINT ["yarn", "run", "test"]\n')))}p.isMDXComponent=!0}}]);